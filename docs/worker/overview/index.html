<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Travis CI: About - </title>
    <link rel="stylesheet" type="text/css" href="/style.css" media="screen">
  </head>
  <body>
    <div id="navigation">
      <div class="wrapper">
        <a href="http://travis-ci.org" id="logo">travis-ci<span>.org</span></a>
        <ul>
          <li><a href="/">Blog</a></li>
          <li><a href="/docs/">Docs</a></li>
          <li class="right"><a href="http://travis-ci.org">go to travis-ci.org &rarr;</a></li>
        </ul>
      </div>
    </div>

    <div id="header">
      <div class="wrapper">
        <h1 class="riddle"><a href="/" title="Travis">Travis CI</a></h1>
        <p>An open-source, distributed build system for the Ruby community.</p>
      </div><!-- /.wrapper -->
    </div><!-- /#header -->

    <div id="content">
      <div class="wrapper">
        <div class="pad">
          <div id="main">
            

            <h2 id="the-worker-overview">The worker: overview</h2>

<p>Workers consist of the following elements:</p>

<ul>
  <li>The worker daemon processes which are (currently) based on Resque and execute
the actual work inside of a VirtualBox VM. These worker processes are managed
through God.</li>
  <li>The VirtualBox VMs each of which is permanently assigned to a worker process
through a unique port setting. These VMs are managed through Vagrant, a Ruby
wrapper for VirtualBox which provides a commandline interface.</li>
  <li>The Chef cookbooks which are used to provision the VirtualBox VMs.</li>
</ul>

<p>There are a few Thor tasks which can be used to perform maintenance tasks, but
you might need to update files, start workers and/or rebuild or provision VMs
manually. You can check for existing Thor tasks with <code>thor -T</code>.</p>

<h3 id="vagrant">Vagrant</h3>

<p>Vagrant is as a Ruby wrapper for VirtualBox and it has a command line interface
which we use for VM management.</p>

<p>Our strategy for building VirtualBox VMs using Vagrant works as follows:</p>

<ul>
  <li>Optionally reset <em>all</em> VirtualBox settings and VMs, stop all VirtualBox
daemons.</li>
  <li>Download <code>lucid32.box</code> to <code>~/travis-worker</code> unless it’s already there.</li>
  <li>Import <code>lucid32.box</code> as a Vagrant box named <code>base</code>.</li>
  <li>Boot up and provision a Vagrant VM named “base” based on this box and using
the cookbooks.</li>
  <li>Package (export) the provisioned “base” VM to a package named <code>base.box</code>
stored in <code>~/travis-worker</code>.</li>
  <li>Import the <code>base.box</code> package as Vagrant boxes <code>worker-1</code>, <code>worker-2</code>, …</li>
  <li>Boot up Vagrant VMs named <code>worker-1</code>, <code>worker-2</code>, …</li>
</ul>

<p>Warning: you do <em>not</em> want to reset VirtualBox with our Thor tasks if you are
using VirtualBox (or Vagrant) for anything else than Travis worker development.
The respective Thor tasks will always ask you though.</p>

<h3 id="cookbooks">Cookbooks</h3>

<p>The Chef cookbooks are used to provision the VirtualBox VMs. They are managed
in a <a href="http://github.com/travis-ci/travis-cookbooks">separate repository</a> and
cloned to <code>vendor/cookbooks</code>.</p>

<h3 id="virtualbox">VirtualBox</h3>

<p>You can use the VirtualBox <code>vboxmanage</code> command line interface to manage
VirtualBox VMs directly (i.e. without using the Vagrant interface). This is
sometimes useful for inspecting VM details. Find documentation about <code>vboxmanage</code>
<a href="http://www.virtualbox.org/manual/ch08.html">here</a>.</p>

<h3 id="sandboxing-builds">Sandboxing builds</h3>

<p>In order to sandbox executing code from userland we use VirtualBox VM snapshots.</p>

<p>Doing so we will roll back everything to the virgin booted state that is the
result of the provisioning. That means that even git clone’d code and downloaded
rubygems will be gone after the rollback.</p>

<p>To be more precise here’s what happens:</p>

<ul>
  <li>The worker gets a build job from the queue.</li>
  <li>It takes a snapshot from the virgin VM.</li>
  <li>It git-clones the repository, bundle-installs dependencies and runs the build.</li>
  <li>It then powers the VM off (equivalent of pulling the power plug).</li>
  <li>For each existing snapshot it first restores and then deletes it one by one.
(This is to make sure that in case an uncaught exception has happened all
snapshots are still restored and deleted).</li>
  <li>It restarts the VM.</li>
  <li>The worker is now ready to wait for the next build job.</li>
</ul>

          </div><!-- /#main -->
          <div id="sidebar">
            <h2>Contact</h2>
            <ul>
              <li><a href="http://github.com/travis-ci">Github</a></li>
              <li><a href="http://twitter.com/travisci">Twitter</a></li>
              <li><a href="irc://irc.freenode.net#travis">IRC</a></li>
              <li><a href="http://groups.google.com/group/travis-ci">Mailinglist</a></li>
            </ul>
            <h2>Documentation</h2>
            <ul>
              <li><a href="/docs/getting-started/">Getting started</a></li>
              <li><a href="/docs/build-configuration/">Build configuration</a></li>
            </ul>
            <h2>Under construction</h2>
            <ul>
              <li><p>Our site is still under construction. You can help us in: travis#irc.freenode.net</p></li>
            </ul>
          </div><!-- /#sidebar -->
        </div><!-- /.pad -->
      </div><!-- /.wrapper -->
    </div><!-- /#content -->

    <div id="footer">
      <div class="wrapper">
        <div class="box">
          <p>This site is maintained by the <a href="http://github.com/travis-ci">Travis CI community</a>. Feel free to <a href="http://github.com/travis-ci/travis-ci.github.com">contribute</a>!</p>
        </div>
        <div class="box">
          <p>This design was kindly provided by the talented Ben Webster of <a href="http://www.plus2.com.au">Plus2</a>.</p>
        </div>
        <div class="box last">
          <ul>
            <li><a href="http://github.com/travis-ci/travis-ci" title="">View the Source</a></li>
            <li><a href="http://twitter.com/travisci" title="">Travis CI on Twitter</a></li>
          </ul>
        </div><!-- /.box -->
      </div><!-- /.wrapper -->
    </div><!-- /#footer -->
  </body>
</html>
